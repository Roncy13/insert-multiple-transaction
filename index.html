<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Products</title>
	<link rel="icon" href="img/Fevicon.png" type="image/png">
  <link rel="stylesheet" href="vendors/bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="vendors/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="vendors/themify-icons/themify-icons.css">
	<link rel="stylesheet" href="vendors/linericon/style.css">
  <link rel="stylesheet" href="vendors/owl-carousel/owl.theme.default.min.css">
  <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css">
  <link rel="stylesheet" href="vendors/nice-select/nice-select.css">
  <link rel="stylesheet" href="vendors/nouislider/nouislider.min.css">

  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  	<header class="header_area">
        <div class="main_menu">
          <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
              <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                <ul class="nav-shop pull-right mt-3 w-100 text-right">
                  <li class="nav-item"><button><i class="ti-shopping-cart"></i><span class="nav-shop__circle" id = "shopping-items">0</span></button> </li>
                </ul>
              </div>
            </div>
          </nav>
        </div>
      </header>
	<!-- ================ category section start ================= -->		  
  <section class="section-margin--small mb-5">
    <div class="container">
      <div class = "row mb-2">
        <ul class="card-product__imgOverlay">
          <li><button><i class="ti-shopping-cart"></i></button></li>
        </ul>
      </div>
      <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12">
          <section class="lattest-product-area pb-40 category-list">
            <div class="row" id = "products-page">
            </div>
          </section>
          <!-- End Best Seller -->
        </div>
      </div>
    </div>
  </section>

  <!--================ Start footer Area  =================-->	
	<footer>
		<div class="footer-bottom">
			<div class="container">
				<div class="row d-flex">
					<p class="col-lg-12 footer-text text-center">
						<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
				</div>
			</div>
		</div>
	</footer>
	<!--================ End footer Area  =================-->



  <script src="vendors/jquery/jquery-3.2.1.min.js"></script>
  <script src="vendors/bootstrap/bootstrap.bundle.min.js"></script>
  <script src="vendors/skrollr.min.js"></script>
  <script src="vendors/owl-carousel/owl.carousel.min.js"></script>
  <script src="vendors/nice-select/jquery.nice-select.min.js"></script>
  <script src="vendors/nouislider/nouislider.min.js"></script>
  <script src="vendors/jquery.ajaxchimp.min.js"></script>
  <script src="vendors/mail-script.js"></script>
  <script src="js/main.js"></script>
  <script>
    var URL  = "http://localhost/products/api/";

    function fetchProducts() {
      var productsPage = $("#products-page");

      $.ajax({
        method: "GET",
        url: URL + "products-list.php",
        success: function(response) {
          var data = response.data;

          data.forEach(function(row) {
            var holder = $("<div>").attr("class", "col-lg-4 col-md-6"),
              cardProduct = $("<div>").attr("class", "card text-center card-product"),
              productImg = $("<div>").attr("class", "card-product__img"),
                img = $("<img>").attr("class", "card-img"),
                ul = $("<ul>").attr("class", "card-product__imgOverlay"),
              cardBody = $("<div>").attr("class", "card-body");
          
            var 
              liSearch = $("<li>")
                .append(
                  $("<button>").append(
                    $("<i>").attr("class", "ti-search")
                  )
                ),
              liShoppingCart = $("<li>")
                .append(
                  $("<button>").append(
                    $("<i>")
                      .attr("class", "ti-shopping-cart")
                      .attr("product-id", row.id)
                  )
              ),
              liHeart = $("<li>")
                .append(
                  $("<button>").append(
                    $("<i>").attr("class", "ti-heart")
                  )
              );

            ul.append(liSearch);
            ul.append(liShoppingCart);
            ul.append(liHeart);
              
            // set Image
            img.attr("src", "img/product/" + row.img);

            // set Product with Img

            productImg.append(img);
            productImg.append(ul);
            
            cardProduct.append(productImg);
            
            // Set Product Details

            cardBody.append(
              $("<p>").html(row.category)
            );

            cardBody.append(
              $("<h4>")
                .attr("class", "card-product__title")
                .append(
                  $("<a>")
                    .attr("href", "#")
                    .html(row.description)
                )
            );

            cardBody.append(
              $("<p>")
                .attr("class", "card-product__price")
                .html("$ "+row.price)
            );

            holder.append(cardProduct);
            holder.append(cardBody);

            productsPage.append(holder);
          });
        }
      });
    }

    $(document).on("click", ".ti-shopping-cart", function(row) {
      var id = ($(row.target).attr("product-id"));
      
      buyProduct(id);
    });

    function buyProduct(id) {
      var items = JSON.parse(localStorage.getItem("buy-product")) || [];

      console.log(items);

      items.push(parseInt(id));

      var itemCount = items.length;
      localStorage.setItem("buy-product", JSON.stringify(items));
      $("#shopping-items").html(itemCount);
    }

    fetchProducts();
    
    localStorage.removeItem("buy-product");
  </script>
</body>
</html>